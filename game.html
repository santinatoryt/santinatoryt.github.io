<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Snake Game - Corregido</title>
<style>
  :root{
    --bg:#0a0a0f;
    --neon:#00eaff;
    --accent:#ff0066;
  }
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--bg);
    color:var(--neon);
    font-family:Arial,Helvetica,sans-serif;
  }
  #gameBox{
    text-align:center;
    width:460px;
  }
  canvas{
    display:block;
    margin:10px auto 8px;
    background:#111;
    border:4px solid var(--neon);
    box-shadow:0 0 20px rgba(0,234,255,0.25);
  }
  .controls{
    display:flex;
    gap:10px;
    justify-content:center;
    margin-top:8px;
  }
  button{
    padding:10px 16px;
    background:var(--neon);
    color:#001;
    border:none;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 0 12px rgba(0,234,255,0.25);
  }
  p{ margin:6px 0 0; }
</style>
</head>
<body>
    <nav class="menu">
    <a href="index.html">Contador</a>
    <a href="game.html">Juego</a>
    <a href="password.html">Generar Contrase√±a</a>
    <a href="time.html">Cron√≥metro / Temporizador</a>
</nav>

<div id="gameBox">
  <h2>üêç Snake Game</h2>
  <canvas id="game" width="400" height="400" tabindex="0"></canvas>
  <p>Puntaje: <span id="score">0</span></p>
  <div class="controls">
    <button id="startBtn">Iniciar</button>
    <button id="resetBtn">Reiniciar</button>
  </div>
  <p style="font-size:12px; margin-top:6px; color:rgba(0,234,255,0.8)">
    Usa las flechas ‚Üê ‚Üë ‚Üí ‚Üì
  </p>
</div>

<script>
/* ----- CONFIG ----- */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');

const CELL = 20;            
const COLS = canvas.width / CELL;
const ROWS = canvas.height / CELL;

/* ----- ESTADO DEL JUEGO ----- */
let snake, direction, nextDirection, food, score, tickInterval, running, lost;

/* ----- IM√ÅGENES ----- */
const imgSnake = new Image();
imgSnake.src = 'snake.png'; 

const imgApple = new Image();
imgApple.src = 'apple.png';

/* ----- UTILIDADES ----- */
function randomCell(){
  return {
    x: Math.floor(Math.random() * COLS) * CELL,
    y: Math.floor(Math.random() * ROWS) * CELL
  };
}

function posEqual(a,b){
  return a.x === b.x && a.y === b.y;
}

function placeFood(){
  let tries = 0;
  do {
    food = randomCell();
    tries++;
    if (tries > 1000) break;
  } while (snake.some(part => posEqual(part, food)));
}

/* ----- INICIO / REINICIO ----- */
function resetGame(){
  const startX = 80;
  const startY = 140;

  snake = [
    {x: startX, y: startY},
    {x: startX - CELL, y: startY},
    {x: startX - 2*CELL, y: startY}
  ];

  direction = 'right';
  nextDirection = 'right';
  score = 0;
  scoreEl.textContent = score;
  running = false;
  lost = false;
  clearInterval(tickInterval);
  placeFood();
  drawAll();
}

function startGame(){
  if (running || lost) return;
  running = true;
  tickInterval = setInterval(gameTick, 120);
  canvas.focus();
}

/* ----- L√ìGICA PRINCIPAL ----- */
function gameTick(){
  if (lost) return;

  if (isOpposite(nextDirection, direction) === false) {
    direction = nextDirection;
  }

  const head = { ...snake[0] };
  if (direction === 'up') head.y -= CELL;
  if (direction === 'down') head.y += CELL;
  if (direction === 'left') head.x -= CELL;
  if (direction === 'right') head.x += CELL;

  snake.unshift(head);

  if (posEqual(head, food)){
    score++;
    scoreEl.textContent = score;
    placeFood();
  } else {
    snake.pop();
  }

  if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height
      || snake.slice(1).some(p => posEqual(p, head))){
    clearInterval(tickInterval);
    running = false;
    lost = true;
    drawAll();
    drawGameOver();
    return;
  }

  drawAll();
}

function isOpposite(dir1, dir2){
  return (dir1 === 'up' && dir2 === 'down') ||
         (dir1 === 'down' && dir2 === 'up') ||
         (dir1 === 'left' && dir2 === 'right') ||
         (dir1 === 'right' && dir2 === 'left');
}

/* ---------------- CUADR√çCULA ---------------- */
function drawGrid(){
  ctx.strokeStyle = 'rgba(255,255,255,0.07)';
  ctx.lineWidth = 1;

  for (let x = 0; x <= canvas.width; x += CELL) {
    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x, canvas.height);
    ctx.stroke();
  }
  for (let y = 0; y <= canvas.height; y += CELL) {
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(canvas.width, y);
    ctx.stroke();
  }
}

/* ----- DIBUJO ----- */
function drawAll(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawGrid();  // ‚Üê LA NUEVA CUADR√çCULA AQU√ç

  if (imgApple.complete && imgApple.naturalWidth !== 0) {
    ctx.drawImage(imgApple, food.x, food.y, CELL, CELL);
  } else {
    ctx.fillStyle = '#ff0066';
    ctx.fillRect(food.x, food.y, CELL, CELL);
  }

  for (let i = 0; i < snake.length; i++){
    const part = snake[i];
    if (imgSnake.complete && imgSnake.naturalWidth !== 0) {
      ctx.drawImage(imgSnake, part.x, part.y, CELL, CELL);
    } else {
      ctx.fillStyle = (i === 0) ? '#00ffd3' : '#00eaff';
      ctx.fillRect(part.x, part.y, CELL, CELL);
      ctx.strokeStyle = 'rgba(0,0,0,0.25)';
      ctx.strokeRect(part.x+0.5, part.y+0.5, CELL-1, CELL-1);
    }
  }
}

function drawGameOver(){
  ctx.fillStyle = 'rgba(0,0,0,0.5)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = '#ff3333';
  ctx.font = '36px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('¬°PERDISTE!', canvas.width/2, canvas.height/2 - 10);

  ctx.fillStyle = '#ffffff';
  ctx.font = '18px Arial';
  ctx.fillText('Puntaje final: ' + score, canvas.width/2, canvas.height/2 + 20);

  ctx.fillStyle = '#00eaff';
  ctx.font = '14px Arial';
  ctx.fillText('Pulsa REINICIAR para jugar otra vez', canvas.width/2, canvas.height/2 + 48);
}

/* ----- TECLAS ----- */
document.addEventListener('keydown', (e) => {
  const key = e.key;

  if (key === 'ArrowUp') { if (direction !== 'down') nextDirection = 'up'; e.preventDefault(); }
  if (key === 'ArrowDown') { if (direction !== 'up') nextDirection = 'down'; e.preventDefault(); }
  if (key === 'ArrowLeft') { if (direction !== 'right') nextDirection = 'left'; e.preventDefault(); }
  if (key === 'ArrowRight') { if (direction !== 'left') nextDirection = 'right'; e.preventDefault(); }

  if (key === ' '){
    e.preventDefault();
    if (lost) return;
    if (running) { clearInterval(tickInterval); running=false; }
    else startGame();
  }
});

startBtn.addEventListener('click', startGame);
resetBtn.addEventListener('click', resetGame);
resetGame();
</script>

</body>
</html>
